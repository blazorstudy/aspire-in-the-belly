# 베이스 이미지 설정
FROM mcr.microsoft.com/openjdk/jdk:17-ubuntu

# 작업 디렉토리 설정
WORKDIR /app

# 빌드 파일 복사
COPY ./build/libs/weather-0.0.1-SNAPSHOT.jar /app/app.jar
COPY ./opentelemetry-javaagent.jar /app

ENV OTEL_BLRP_SCHEDULE_DELAY=OTEL_BLRP_SCHEDULE_DELAY
ENV OTEL_BSP_SCHEDULE_DELAY=OTEL_BSP_SCHEDULE_DELAY
ENV OTEL_DOTNET_EXPERIMENTAL_ASPNETCORE_DISABLE_URL_QUERY_REDACTION=OTEL_DOTNET_EXPERIMENTAL_ASPNETCORE_DISABLE_URL_QUERY_REDACTION
ENV OTEL_DOTNET_EXPERIMENTAL_HTTPCLIENT_DISABLE_URL_QUERY_REDACTION=OTEL_DOTNET_EXPERIMENTAL_HTTPCLIENT_DISABLE_URL_QUERY_REDACTION
ENV OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES=OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES
ENV OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES=OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES
ENV OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY=OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY
ENV OTEL_EXPORTER_OTLP_ENDPOINT=OTEL_EXPORTER_OTLP_ENDPOINT
ENV OTEL_EXPORTER_OTLP_HEADERS=OTEL_EXPORTER_OTLP_HEADERS
ENV OTEL_EXPORTER_OTLP_PROTOCOL=OTEL_EXPORTER_OTLP_PROTOCOL
ENV OTEL_METRIC_EXPORT_INTERVAL=OTEL_METRIC_EXPORT_INTERVAL
ENV OTEL_RESOURCE_ATTRIBUTES=OTEL_RESOURCE_ATTRIBUTES
ENV OTEL_SERVICE_NAME=OTEL_SERVICE_NAME
ENV OTEL_TRACES_SAMPLER=OTEL_TRACES_SAMPLER

# 포트 노출
EXPOSE 8080

# 애플리케이션 실행
ENTRYPOINT ["java","-javaagent:/app/opentelemetry-javaagent.jar", "-jar","/app/app.jar"]